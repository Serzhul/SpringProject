<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mybatis.Book">
	<cache />
		<select id="getBookInfo" parameterType="String" resultType="Book">
			select * from book where ISBN = #{isbn} order by isbn
		</select>
		
		<select id="getBooks" resultType="Book">
			select * from book order by isbn
		</select>
		
		<select id="getBooksbyMainCategory" parameterType="String" resultType="Book">
			select * from book where book_m_category = #{book_m_category} order by isbn
		</select>
		
		<select id="getBestSeller" parameterType="int" resultType="Book">
		select isbn, sales, b.book_subject,  b.book_writer, b.book_m_category, avgr, rk, rm
		from (SELECT isbn i, count(isbn) as sales , RANK() OVER (ORDER BY count(isbn) DESC) as rk
        		FROM library group by isbn) a, book b, (select isbn i2, avg(rating) avgr, count(isbn) rm from review group by isbn) c
        <where>
        AND c.i2 = b.isbn
        AND a.i = b.isbn
        AND rk &lt;= #{range}
        </where>
        order by sales desc, isbn
		</select>
		
		<select id="getSearchResult" parameterType="String" resultType="Book">
		select * from book where upper(book_subject)
		like '%' ||  upper(#{keyword}) || '%'
		or book_writer like '%' ||  #{keyword} || '%'
		</select>
		
		<select id="getBestReview" resultType="Review">
		select content, regdate, book_subject, review.isbn
		from review, book
		where like_cnt >=3 and book.isbn=review.isbn
		</select>
		
		<select id="getBestReviewContent" resultType="String">
		select content
		from review, book
		where like_cnt >=3 and book.isbn=review.isbn
		</select>
		
		

		
</mapper>